---
title: "Antigen Test Usefulness"
output: html_document
author: Darjus Hosszejni
date: March 25, 2021
---

Lately, I have heard that antigen tests do not make sense because they are so imprecise.
I am based in Vienna where antigen tests are free and many people get tested regularly.
There are walk-in and drive-in test centers separately for symptomatic and asymptomatic patients.

Here are some quick computations about the COVID antigen tests.

Terminology
---

* Sensitivity: probability of correct result *if you are infected*, i.e. $P(\text{positive antigen}\mid\text{COVID})$
* Specificity: probability of correct result *if you are not infected*, i.e. $P(\text{negative antigen}\mid\text{no COVID})$

Source: [Wikipedia](https://en.m.wikipedia.org/wiki/Confusion_matrix)

Input
---

[This study](https://www.cdc.gov/mmwr/volumes/69/wr/mm695152a3.htm).
If you are symptomatic, then

```{r, include=FALSE}
sspec <- 0.989
ssens <- 0.80
aspec <- 0.984
asens <- 0.412
```

* Sensitivity = `r 100*ssens`%
* Specificity = `r 100*sspec`%

If you are asymptomatic, then

* Sensitivity = **`r 100*asens`%**
* Specificity = `r 100*aspec`%

These numbers are estimates and they have their own error.
I ignore that.

Estimate for the percentage of population that is infected today: diepresse.at says there are 33521 official active cases.
The true number is said to be 5-10 times larger, let's say ca. 300000.
That is 300000/9000000 = `r covid <- round(3/90, 4); nocovid <- 1 - covid; covid*100`%.
I will use that for $P(\text{COVID})$.

Computation
---

The interesting question is the probability if being negative given a negative result.
The figures above give us the reverted probability: e.g. getting a negative result given that you are negative (that is specificity).

One uses [Bayes' theorem](https://statmodeling.stat.columbia.edu/2020/12/15/literally-a-textbook-problem-if-you-get-a-positive-covid-test-how-likely-is-it-that-its-a-false-positive/) to revert the probability:
$$P(A\mid B)=\frac{P(B\cap A)}{P(B)}$$
In our case, we need a more detailed variant of that formula:
$$P(\text{no COVID}\mid \text{negative antigen}) = \frac{P(\text{negative antigen}\mid\text{no COVID})P(\text{no COVID})}{P(\text{negative antigen}\mid\text{no COVID})P(\text{no COVID}) + P(\text{negative antigen}\mid\text{COVID})P(\text{COVID})}$$
where $P(\text{negative antigen}\mid\text{COVID})=1-P(\text{positive antigen}\mid\text{COVID})$.

### Asymptomatic

That gives for **asymptomatic** people
$$P(\text{no COVID}\mid \text{negative antigen}) \approx \frac{`r aspec` \cdot `r nocovid`}{`r aspec` \cdot `r nocovid` + (1-`r asens`)\cdot (1-`r nocovid`)}=`r round((aspec * nocovid) / (aspec * nocovid + (1-asens) * (1-nocovid)) * 100, 2)`\%$$

So every 50th negative COVID antigen test gives false inference for asymptomatic people.

### Symptomatic

And that gives for **symptomatic** people
$$P(\text{no COVID}\mid \text{negative antigen}) \approx \frac{`r sspec` \cdot `r nocovid`}{`r sspec` \cdot `r nocovid` + (1-`r ssens`)\cdot (1-`r nocovid`)}=`r round((sspec * nocovid) / (sspec * nocovid + (1-ssens) * (1-nocovid)) * 100, 2)`\%$$
Only 7 out of 1000 negative test results give false inference for symptomatic people.

## Discussion

It is important to combine the test result with observing symptoms.

Still, that 97.98% is not *soooo* bad.
Since the specificity is so high, the most important factor is actually $P(\text{COVID})$, i.e. the general percentage of infected people (around you).
By modifying that number, we get the following plot for the aforementioned probabilities.
```{r, fig.asp=1, fig.width=9, echo=FALSE}
curve((aspec * (1 - x)) / (aspec * (1 - x) + (1 - asens) * x), from = 0.001, to = 0.05,
      ylim = c(0.95, 1),
      ylab = "P(no COVID | negative antigen)", xlab = "Fraction of infected people in the population",
      main = "P(no COVID | negative antigen) with varying the fraction of infected population")
curve((sspec * (1 - x)) / (sspec * (1 - x) + (1 - ssens) * x), add = TRUE, col = "blue")
legend("topright",
       legend = c("Asymptomatic", "Symptomatic"),
       lty = 1, col = c("black", "blue"))
```
